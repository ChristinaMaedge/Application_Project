---
title: "Application Project Umsatzprognose Bäckerei"
author: "Christina M. Mädge, Marco Landt-Hayen"
date: "6.4.2020"
output: rmdformats::readthedown
---

```{r message=FALSE, error=FALSE, warning=FALSE}
library(tidyverse) # Datenaufbereitung und ggplot
```

# 1. Allgemeine Projektinformationen

## 1.1 Ausgangslage
Die Bestellung von Bäckereien ist häufig noch ein manueller und zeitaufwändiger Prozess, der auf adjustierten Vorwochenwerten basiert. Eine systematische Planung unter Einbeziehung von Mustern findet nur eingeschränkt statt.

## 1.2 Zielsetzung 
Es wird ein Prognosemodell entworfen, das Bäckereien ein bessere Planungsgrundlage auf Warengruppenebene bietet. 
Lösungsansatz

Mit Hilfe von verschiedenen Daten und Einflussfaktoren soll diese Umsätze je Warengruppe prognostiziert werden. 
-	Umsatzdaten, Wetterdaten, Veranstaltungsdaten
-	Weitere Einflussfaktoren (Neueröffnung, Aktionen,…)

## 1.3 Datenbasis:
-	2010 bis Ende 2019
-	Umsätze je Warengruppe und Tag
-	(Retourenquoten)
-	(Zeitpunkt letzter Verkauf)
-	(Öffnungszeiten)


# 2 Datenexploration

## 2.1 Einlesen der Daten

Im ersten Schritt müssen die Daten zunächst eingelesen werden um sie bearbeiten zu können:
```{r}
Beispieldaten <- read.csv("data/Beispieldaten.csv")
KiWo <- read.csv("data/KiWo.csv")
Wetter <- read.csv("data/Wetter.csv")
```

### Überprüfung der Datenstrukturen
```{r}
str(Beispieldaten)
glimpse(Beispieldaten)
typeof(Beispieldaten$Datum)
range(Beispieldaten$Warengruppe)
range(Beispieldaten$Umsatz)
```

Der Datensatz *Beispieldaten* ist ein Dataframe, enthält 11164 Zeilen und 3 Variablen:

* Datum (`fct`)
* Warengruppe (`int`) mit den Warengruppen 1 - 6
* Umsatz (`dbl`) mit Werten zwischen 7.05 und 1879.46.

Umsätze werden jeweils 5 mit Nachkommastellen angezeigt. Hier sollte eine Änderung vorgenommen und die Variable auf zwei Nachkommastellen gerundet werden (?).

```{r}
str(KiWo)
glimpse(KiWo)
any(KiWo$KielerWoche != 1)  # Prüfung: Ist die Ausprägung in irgendeiner Zelle der Spalte ungleich 1?
all(KiWo$KielerWoche == 1)  # Prüfung: Sind alle Ausprägungen gleich 1? 
```

Der Datensatz *KiWo* enthält 71 Zeilen und die beiden Variablen Datum (`fct`) und KielerWoche (`int`), wobei die einzige Ausprägung der Variablen KielerWoche die Ziffer 1 ist.

```{r}
str(Wetter)
glimpse(Wetter)
range(Wetter$Bewoelkung, na.rm = TRUE)
range(Wetter$Temperatur, na.rm = TRUE)
range(Wetter$Windgeschwindigkeit)
range(Wetter$Wettercode, na.rm = TRUE)
```

Der Datensatz *Wetter* enthält 2601 Zeilen und fünf Variablen:

* Datum (`fct`)
* Bewoelkung (`int`) mit Werte von 0 bis 8
* Temperatur (`dbl`) mit Werten zwischen -10.25 und 32.67 Grad Celsius
* Windgeschwindigkeit (`int`) mit Werten zwischen 3 und 35    ?????????? Einheit?
* Wettercode (`int`) mit Werten zwischen 0 und 95.

Alle Datensätze enthalten die Variable `Datum` über die die Datensätze vereinigt werden können. Die Datumsvariablen sind beim Einlesen allesamt in Faktoren umgewandelt worden. Dies ist zu ändern. 

## Überprüfung des Anfangs- und Endzeitpunkt der Zeitreihendaten
```{r}
min(Beispieldaten$Datum)
max(Beispieldaten$Datum)
```

Die Daten reichen vom 01.07.2013 bis 30.07.2019

## Überprüfung auf fehlende Werte
```{r}
sum(is.na(Beispieldaten))
sum(is.na(KiWo))
sum(is.na(Wetter))
which(is.na(Wetter))
sum(is.na(Wetter$Datum))
sum(is.na(Wetter$Bewoelkung))
sum(is.na(Wetter$Temperatur))
sum(is.na(Wetter$Windgeschwindigkeit))
sum(is.na(Wetter$Wettercode))
```

* Der Datensatz "Beispieldaten" enthält keine fehlenden Werte.
* Der Datensatz "KiWo" enthält keine fehlenden Werte.
* Der Datensatz "Wetter" enthält 679 fehlende Werte, davon 10 in der Spalte "Bewoelkung", 669 in der Spalte "Wettercode".

## Überprüfung der Variable Umsatz auf Ausreißer
```{r}
boxplot(Beispieldaten$Umsatz)
hist(Beispieldaten$Umsatz)
density(Beispieldaten$Umsatz)
apropos("density")

# Visualisierung
Beispieldaten %>% 
  select(Umsatz) %>% 
  ggplot(aes(Umsatz)) +
  geom_density()

# tapply
tapply(Beispieldaten$Umsatz, Beispieldaten[,2], sum)
tapply(Beispieldaten$Umsatz, Beispieldaten[,2], mean)
```
